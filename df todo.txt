commit notes:
-changed ai retreat logic to be more unpredictable
-fixed oversight where unit move params considered for targeting were not updated properly during combos, leading to units using moves they were wildly out of range for.

======= NOTES
collision layers/masks notes:
	layer: gets hit
	mask: hits others
	- 1: everything related to units moving and hitting world border or obstacles. (all units)
	- 2: enemy unit physical collision layer (all enemies)
	- 3: ally unit physical collision layer (all allies, NOT player)
	- 9: everything related to RANGED ANTI-ENEMY projectiles hitting units and obstacles.
	- 10: everything related to MELEE ANTI-ENEMY projectiles
	- 17: everything related to ANTI-ALLY projectiles hitting units and obstacles
	- 18: everything related to ANTI-ALLY projectiles hitting units and obstacles

======= THE BIG DEAL: 

What is this game's thing? Here is what it is:
	- the preset sequences of moves of the loadout system.
	- the on the fly selection of loadouts as you go. A mix of preparation and improvisation.
	- swapping target mid-combo, that feeling of like weaving through a horde of enemies, fighting them all but making it through, stopping them as they launch themselves at you.
	(you can select this by pressing a number key at any time while the loadout is active/swapping)
	so you can decide how you want to continue the combo in the moment.

some more mechanically deep things:
	- you also want to use your movesets to defend yourself
	- things like the bubble is great for protecting you from counterattacks
	- things like lingering melee hitboxes are also great at this

=======

1. generalize move scene for player and ai sharing................[DONE]
2. anse spritesheet art and import................................[DONE]
3. generalize ai unit scene.......................................[DONE]
4. recreate units with generalized ai scene.......................[DONE]
5. adelie spritesheet art and import..............................[DONE]
6. add pick-off ai behavior.......................................[DONE]
7. fixed a bug where units were dropping their combos.............[DONE]
8. added mechanic to prevent loadout looping......................[DONE]
9. added ai unit approach conversion from advance to attack.......[DONE]
10. added ai unit attack permission lockout prevention............[DONE]
11. Friday facerushing fix pls....................................[DONE]
12. expand unitbodies for better collision........................[DONE]
13. grace note for everyone.......................................[DONE]
14. end battle signal.............................................[DONE]
15. enemy ai mobbing behavior.....................................[DONE]
16. better retreating.............................................[DONE]
17. stricter usage parameters.....................................[]

. create second enemy type (adelie cabler).......................[]

. combat scene effects...........................................[]
. combat scene sound.............................................[]

. test battles with visual overhaul..............................[]
[gate]. visual overhaul..........................................[]

. real game scenes...............................................[]


- stricter combos:
	- dont just always follow up
	- if next move not in range, then dont use it
	test with Friday: rifle into snapswing (should stop after rifle at range)
	- this should be handled directly in start_attack(), since it gets called all the time
	right?
	- issue is max range is not getting updated after first move ends.

- visuals next steps:
	- shadows, try baking them in again. or use a separate sprite in the unit scene.
	- map backgrounds, walls are good but floors look like a different style

- more enemies:
	recolor and draw something new.
	- the cabler is dragging cables from a wing behind it. Beat up.
	[adelie cabler]
	1 loadout:
	- move 1: cable fling, sends out some slow projectiles
	- move 2: shock, creates a shock area right in front of them, like the shock move
	so they fire, then create a field to defend themselves

	[adelie snowroller]
	1 loadout:
	- move 1: snowball, sends out a slow and large projectile, a big ball of snow

	[emperor adelie]
	(actually not an adelie, but the name is too strong. emperor penguin guy)
	bigger and tougher. hits harder, idk.
	

- real game scenes:
	what is the first scene of the game? What do you need to make it.
	- get started on that.
	plot out the first few scenes (let's not redo stuff.)
	- then, make them. This is the best test.

=== [visual overhaul gate] ===

- individual ai unit behaviour?
	- create a different behaviour for ai units from scratch?
	still keep this in mind, maybe we will want this.

- retreat destination and pathing still needs work:
	- lots of time units bump against walls
	- change possible angle? or give bias towards the center?
	- or: if near edge of map, then select retreat spot differently

- stricter ai patterns?:
	- when a guy gets hit, immediately force swap into retreat intention (doing this)
	- cannot get the same intention twice in a row (could try doing this)
		- could force units into sleep more, so they don't just stand there.
	- if start in standoff, then sleep intention instead for the wander

- Friday unit:
	- object
	- spritesheet
	- moveset

- another combo mechanic (low priority):
	- a single loadout can only be used a single time in a combo
	- you can't loop back around to the same loadout twice in one go

- combat feeling review:
	- it's not enough to just work, it must also feel right.
	we will be able to judge it feels right if we're in a situation where:
	- we have a scene in a pretty encounter map with anse + Friday vs like 4 adelie.
	- also test a scene against a more boss-like enemy. Faster to react, does combos, etc
	do these feel good?
	
	important things:
	- does it feel slick? like you know what's happening? what's going on?
	- moves should have weight behind them. it should feel like: Bang! to bang! to bang!
	each thing you do, you're doing on purpose, and the game clearly reacts to you doing it.

sound overhaul:
	lots of things need sound:
	- units moving
	- environment (wind, snow, rain, creaking, etc)
	- unit using a move
	- unit being hit by a move
	- music

- combo routing factors:
	in baldr sky, move order is quite technical because of launching and knockdown
	- our system doesn't have either of these things.
	what limits do we have in terms of which moves you can connect together?
	- move output cost: which will determine the length of your combo, and also last move, which is free.
	- range of the move: mixing close and far ranges can be tricky.
	- knockback: a big knockback move will knock an enemy out of range of a short move.
	- future 'flow': some moves do damage relative to flow generated, and may consume it.

- post battle reward system:
	- can be based on: how fast you won? how little damage both you and your allies took?

=== [combat feeling gate] ====

- grounded snow effect:
	- when you change direction or come to a stop, pop up a snow effect? scattered dust into the air.

- weather effect:
	- snow or rain particle effect on screen, at programmable intensity.

- debris effect:
	- when a unit is defeated, create some relevant debris on the ground near them
	ferra leave parts, Friday will leave her coat, etc.

- system to fire projectiles in multiple directions:
	of course we want moves that are able to shoot in every direction.
	in addition to the projectile list, there is a projectile offset list
	- for each entry in the projectile list, it fires a projectile at every position in the offset list.
	- entries in the list range from 0-359 are correspond to a position around the unit relative to the position
	  of the unit circle arrow.

- camera manager:
	-zoom and move camera so that it can capture everything we want in frame at the same time
	-always the player, and it will expand to try to fit the last _ units you have hit within _ time

- flow mechanic:
	-some moves generate 'flow'
	-some moves can consume 'flow' to change their effect
	just a little something for players to think about when building a combo, that's it.
	-losing flow: if you get hit? if you miss a move?
	-showing flow: something around the player, visually. Like orbs or lines?

- encounter scene expansion:
	a given encounter will be made up of the following:
	- geography: the scene that holds the mat and the obstacles placed on it.
	- army setup: given the geography, this is where all units are placed initially.
	- plot: potential intro and ending cutscene sequences. Kept simple, usually.
	- encounter: rules that dictate how the encounter will play out in terms of combat, like:
		- when to spawn additional enemies/allies (timing, defeated x, etc)
		- unusual victory/defeat conditions (time elapses, ally/boss defeated, etc)
		- scrolling, the route and the speed, if applicable.
		this could end up being complicated, with scrolling, then a room, then more scrolling, etc.
	so create a full encounter scene with all this stuff defined.

- backgrounds and collision (graphical)
	- it would be really cool if objects and background borders had an indicator of where
	  exactly a border is.
	- for example, something like an inobtrusive dotted line around the edges of collision objects.
	bake it into art? seems simplest.
	can then just draw polygons along them.

- red line tracer
	- should we draw a line between mouse position and player to help with aiming?
	- or is it just cool?

- encounter ai:
	-there is an encounter manager which helps with:
		-spawning reinforcements, timing, objectives, ending on death/victory.

start of battle animation:
	-if would be cool if there was an animation with all the rings coming on as the fight began. Like a bootup. Like, rapidly increase the ring's scale from 0 to 1 over a time window.

- loadout system swap choice:
	- a simple and elegant way to determine which loadout you're switching to next
	rather than just going through them all in a preset order.
	(for the beginning, we only have 2 loadouts so we can ignore it for now.)
	(mousewhell scroll?)
	(or pressing 1/2/3/4?) <-- fav so far, because it lets you choose any cleanly.
	(or leftclick/rightclick to select either prev or former loadout?)
	the idea is that, although you can't choose a particular move for any situation, you can choose the perfect loadout for the given moment. So it's a bit higher level.
	remember, it is time sensitive as you only have a short window.
	- but to counteract this, you can enter the next loadout at any time to buffer it.

- ai unit targeting indicator:
	- draw a coloured line from them to the circle of their target? or just in that direction? idk.

- alternate attack system, in case this falls apart:
	you have a combo counter from 1...x
	- you equip weapons (attack patterns) where the move differs depending on combo counter
	- you can switch which weapon you are attacking with in the middle of the combo.
	e.g. you can attack snaphammer1 -> snaphammer2 -> rifle3 -> box4 -> rifle5 -> ...
	or any other combination that you want.	
	note: this does feel like an idea where

=== [vn-ready gate] ===

-visuals (to consider)
	-lip sync
	-blinking
	-breath, hot air in the cold (13!!!)
	-pose changing (like sideview, or back.)
	-small window (for anse's hands, the box, e.g. a necklace, etc)
	-being able to animate while speaking.
	-variable text bubble location, like near the speaker.
	-weather



